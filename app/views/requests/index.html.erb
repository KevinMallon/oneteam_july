
<% provide(:title, 'All requests') %>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>jQuery UI Tabs - Default functionality</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
<link href="/assets/custom.css?body=1" media="all" rel="stylesheet" type="text/css" />
<script>
$(function() {
$( "#tabs" ).tabs();
});
</script>
</head>

<body>
  
<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Requests</a></li>
    <li><a href="#tabs-2">My Profile</a></li>
    <li><a href="#tabs-3">Requests I've Posted</a></li>
    </ul>

<div id="tabs-1">

    <h3>All Requests</h3>

    <ul class="employees">
  
    <% @requests.each do |request| %>
      <% if request.active == "1" %>  
 
        <% if Date.today < request.stop_date %>

      <li>

        <p>
          <b><%= request.project %>:</b> <%= request.start_date %> to <%= request.stop_date %> (Status: <%= request.progress_status %>) </br>
          Posted by: <%= request.employee.name %> in <%= request.employee.location_id %> Office (Group: <%= request.employee.group %>) </br>
          Description: <%= request.content %></br>
          Relevant skills:      
          <% @skillnames = [] %>            
          <% request.request_skills.each do |skill_need| %>
            <% skill_names(skill_need) %>            
          <% end %>            
          <%= @skillnames.join(", ") %> 
        </p>  

        <p>
          Your <em>employee skills</em> score for this project: <%= request.employee_skills_score(current_employee) %> out of a possible <%= request.request_max_score(request) %></br>            
          Your <em>target skills</em> score for this project: <%= request.target_skills_score(current_employee) %> out of a possible <%= request.request_max_score(request) %></br>
        </p>

        <p>
          <% if request.applied_status(current_employee) == "applied" %>
               Applied
          <% elsif request.employee != current_employee %>
               <%= link_to "Apply", new_request_response_path(request), class: "btn" %>
          <% elsif request.employee == current_employee %>
               <span class="attention">You posted this request. You cannot apply for your own requests.</span>
          <% end %>
        </p>

      </li>

        <% end %>
      <% end %>
 
    <% end %>

</ul>    
</div>


<div id="tabs-2">
  <h3>
    My Profile
  </h3>

  <p class="employees">
    <%= link_to 'Edit Profile', edit_employee_path(@employee) %>
  </p></br>
  
  <p>
    <%= gravatar_for @employee %>
  </p>

  <div class="offset2">
    <div class="employees">

    <p>
        Name:
        <%= @employee.name %>
    </p>

    <p>
        Email:
        <%= @employee.email %>
    </p>

    <p>
        Office:
        <%= @employee.location_id %>
    </p>

    <p>
        Department:
        <%= @employee.department %>
    </p>

    <p>
        Group:
        <%= @employee.group %>
    </p>

    <p>
        Job Title:
        <%= @employee.job_title %>
    </p>

    <p>
        Immediate Supervisor:
        <%= @employee.supervisor %>
    </p>

    <p>
        Years with Company:
        <%= @employee.years_at_company %>
    </p>

    <p>Employee Skills:
    <div class="span12">      
      <table>
        <tr>  
          <td class="span2">Skill</td>  
          <td class="span3">Total Experience Points</td>  
          <td class="span3">Average Skill Level</td>  
        </tr>
        <% @skills.each do |skill| %>  
          <tr>      
            <td class="span2"><%= skill.name %></td>      
            <td class="center"><%= @employee.skill_experience_sum(skill.id) %></td>     
            <td class="center"><%= @employee.average_skill_level(skill.id) %></td>
           </tr>  
        <% end %>               
      </table></br>
     </div>  
    </p>

  <p>               
      <% @employee.view_my_ratings %>   
  </p>

<p>My Skill Ratings:  
  <% @employee.employee_skills.each do |es| %>    
  <%= es.skill.name %>(<%= es.level%>)    
  <% end %>  
</p>

  <p>Target Skills:
    <% @skillnames = [] %>            
      <% @employee.target_skills.each do |targ_skill| %>              
      <% skill_names(targ_skill) %>            
      <% end %>            
      <%= @skillnames.join(", ") %>  
  </p>

  <p>
    <b>Projects I've worked on:</b>
    <% if !@employee.selections.nil? %>
    <% @employee.selections.each do |selection| %>          
      <% if selection.employee_id == current_employee.id %>  
        <p>                      
            <em><%= selection.request.project %>:</em>
            <%= selection.request.start_date %> to 
            <%= selection.request.stop_date %> 
            (<%= selection.request.progress_status %>)</br> 
            <% selection.request.responses.each do |selection| %>                    
              <% if !selection.evaluation.nil? %>              
                Skill ratings: <%= selection.employee.view_evaluations(selection) %>
              <% end %> 
          <% end %>
        </p>
      <% end %>        
    <% end %>
    <% end %>
  </p>

  </div>
  </div>
</div>


<div id="tabs-3">
  <h3>Requests I've Posted</h3>

  <ul  class="employees"><li><%= link_to 'New Request', new_request_path %></li></ul>

  <% if !current_employee.requests.empty? %>

     <% @myrequests.each do |request| %> 

        <ul  class="employees">
          <li>
           <p>
              <b><%= request.project %>:</b>
              <%= request.start_date %> - <%= request.stop_date %></br>
               Description: <%= request.content %></br>
              <% if request.active == "1" %>
                Active  <%= link_to 'Edit or Cancel', edit_request_path(request) %></br>
                Relevant skills:      
                <% @skillnames = [] %>            
                <% request.request_skills.each do |skill_need| %>
                  <% skill_names(skill_need) %>            
                <% end %>            
                <%= @skillnames.join(", ") %> 
              </p>
              <% else %>
                <span class="attention">Cancelled</span>
              <% end %>              
          </p>

          <% if request.active == "1" %>
            <p>Applicants:</br>
            <% request.responses.each do |response| %>           
              <% if !response.selections.empty? %>    
                <%= link_to response.employee.name, employee_path(response.employee) %> Selected | 
                  <% if !response.evaluation.nil? %>  
                    <%= link_to 'Edit Employee Skills Evaluation', edit_response_evaluation_path(response,response.evaluation) %></br>
                  <% else %>
                  <%= link_to 'Evaluate Employee Skills', new_response_evaluation_path(response) %></br>
                  <% end %>
                <em>Employee skills</em> score for this project: <%= request.employee_skills_score(response.employee) %> out of a possible <%= request.request_max_score(request) %></br>
                <em>Target skills</em> score for this project: <%= request.target_skills_score(response.employee) %> out of a possible <%= request.request_max_score(request) %></p>                 
              <% else %> 
                <%= link_to response.employee.name, employee_path(response.employee) %> <%= link_to 'Select', new_response_selection_path(response) %></br>
                <em>Employee skills</em> score for this project: <%= request.employee_skills_score(response.employee) %> out of a possible <%= request.request_max_score(request) %></br>
                <em>Target skills</em> score for this project: <%= request.target_skills_score(response.employee) %> out of a possible <%= request.request_max_score(request) %></p> 
              <% end %>
            <% end %>
          <% end %>                       

         </li>
        </ul>
    <% end %>
  <% else %> 
    You have not posted any requests.

<% end %> 
</div>

</div>
</body>
</html>
